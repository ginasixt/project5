{% extends "capstone/layout.html" %}

{% block body %} 
{% load static %}

<div id="calendar">
    <div id="calendar-header">
      <button id="prev">Prev</button>
      <span id="month-year"></span>
      <button id="next">Next</button>
    </div>
    <div id="calendar-body">
      <div id="day-names">
        <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
      </div>
      <div id="days-container"></div>
    </div>
</div>

<script type="text/javascript">
    let groupDates = {{ group_dates|safe }};
    console.log(groupDates);
</script>

<!-- JavaScript code for calendar functionality -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const currentDate = new Date();
        const daysContainer = document.getElementById('days-container');
    
        // Render the month and year in the header
        function renderHeader(date) {
            const monthYear = document.getElementById('month-year');
            monthYear.textContent = date.toLocaleDateString('default', { month: 'long', year: 'numeric' });
        }
    
        // Render the days of the month
        function renderDays(date) {
            daysContainer.innerHTML = '';

            const firstDayOfMonth = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDayOfMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            const totalDays = lastDayOfMonth.getDate();

            const today = new Date();
            const isCurrentMonth = date.getFullYear() === today.getFullYear() && date.getMonth() === today.getMonth();

            // Fill in the days of the month
            for (let i = 1; i <= totalDays; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('day');

                const dayNumberDiv = document.createElement('div');
                dayNumberDiv.classList.add('day-number'); 
                dayNumberDiv.textContent = i;
                dayDiv.appendChild(dayNumberDiv);

                // Convert the current date to the same format as the keys in groupDates
                const currentDate = new Date(date.getFullYear(), date.getMonth(), i);
                const currentDateStr = currentDate.toISOString().split('T')[0];

                // Check if the current date is in groupDates
                if (groupDates.hasOwnProperty(currentDateStr)) {
                    // Add an additional class to the day's div
                    dayDiv.classList.add('group-event');

                    // Create a new div for the group event details
                    const groupEventDiv = document.createElement('div');
                    groupEventDiv.classList.add('event');  // Add a class to the group event div

                    // Create a new link for the group event details
                    const groupEventLink = document.createElement('a');
                    groupEventLink.href = groupDates[currentDateStr].url;
                    groupEventLink.textContent = groupDates[currentDateStr].time + ' ' + groupDates[currentDateStr].name;
                    groupEventLink.classList.add('group-event-link');  // Add a class to the group event link

                    groupEventDiv.appendChild(groupEventLink);
                    dayDiv.appendChild(groupEventDiv);
                }
            

                // Check if the current date is today
                if (isCurrentMonth && i === today.getDate()) {
                    dayDiv.classList.add('today');
                }

                daysContainer.appendChild(dayDiv);
            }
        }
    
        // Change the month displayed
        function changeMonth(month) {
            currentDate.setMonth(currentDate.getMonth() + month);
            renderHeader(currentDate);
            renderDays(currentDate);
        }
    
        // Initialize the calendar on page load
        renderHeader(currentDate);
        renderDays(currentDate);
    
        // Event listeners for changing months
        document.getElementById('prev').addEventListener('click', () => changeMonth(-1));
        document.getElementById('next').addEventListener('click', () => changeMonth(1));
    });
    
</script>
{% endblock %}